# トップページ 訪問者カウント機能 実装計画

## 概要
トップページに通算のページ来訪者数を表示する機能を実装する

---

## 要件確認（質問事項）

### Q1: カウントの保存先
[Question] 訪問者数を保存するバックエンドはどれを使用しますか？

[Answer] A) Vercel KV（Redis）- Vercelと統合、簡単なセットアップ

---

### Q2: 表示位置
[Question] 訪問者数をトップページのどこに表示しますか？

[Answer] A) ヒーローセクションの下

---

### Q3: カウント方式
[Question] どのようにカウントしますか？

[Answer] C) セッションベース（セッションごとに1回）

---

### Q4: デザインスタイル
[Question] 表示のデザインはどのようなスタイルが良いですか？

[Answer] A) シンプルなテキスト + カウントアップアニメーション

---

### Q5: 多言語対応
[Question] 表示テキストは多言語対応が必要ですか？

[Answer] A) はい（日本語/英語で切り替え）

---

## 実装ステップ

### Step 1: Vercel KV のセットアップ
- [x] 1.1 Vercel ダッシュボードで KV データベースを作成
- [x] 1.2 プロジェクトに KV を接続
- [x] 1.3 環境変数（KV_REST_API_URL, KV_REST_API_TOKEN）を取得
- [x] 1.4 `@vercel/kv` パッケージをインストール

[Question] Vercel KV の作成は私（Claude）ではなく、あなたがダッシュボードで行う必要があります。作成後、環境変数を `.env.local` に追加してください。準備ができたら教えてください。

[Answer] 完了。Upstash Redis を作成し、環境変数を設定済み。

---

### Step 2: API エンドポイントの作成
- [x] 2.1 `app/api/visitors/route.ts` を作成
- [x] 2.2 GET: 現在のカウントを取得
- [x] 2.3 POST: セッションチェック後にカウントをインクリメント
- [x] 2.4 セッション管理用の Cookie 処理を実装

---

### Step 3: 訪問者カウントコンポーネントの作成
- [x] 3.1 `components/home/visitor-count.tsx` を作成
- [x] 3.2 カウントアップアニメーションを実装（Framer Motion）
- [x] 3.3 ローディング状態の処理
- [x] 3.4 エラーハンドリング

---

### Step 4: トップページへの統合
- [x] 4.1 `app/[lang]/page.tsx` にコンポーネントを追加
- [x] 4.2 ヒーローセクションの下に配置
- [x] 4.3 初回訪問時にカウントをインクリメントするロジック追加

---

### Step 5: 翻訳ファイルの更新
- [x] 5.1 `locales/ja.json` に翻訳キーを追加
- [x] 5.2 `locales/en.json` に翻訳キーを追加

---

### Step 6: テストとデプロイ
- [ ] 6.1 ローカルでの動作確認
- [x] 6.2 ビルド確認
- [ ] 6.3 コミット & プッシュ
- [ ] 6.4 Vercel でのデプロイ確認

---

## UIデザイン案

### レイアウト
```
┌─────────────────────────────────────────────────────────┐
│                     Hero Section                         │
│                   (既存のヒーロー)                        │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                                                         │
│              Total Visitors: 1,234                      │
│              （累計訪問者数: 1,234）                      │
│                                                         │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                 Featured Projects                        │
│                   (既存のセクション)                      │
└─────────────────────────────────────────────────────────┘
```

### スタイル詳細
- テキスト: `text-foreground-muted`（控えめな色）
- サイズ: `text-sm` または `text-base`
- 配置: 中央寄せ
- アニメーション: 数字が0から実際の値までカウントアップ（約1秒）

### 多言語テキスト
| 言語 | テキスト |
|------|----------|
| 日本語 | 累計訪問者数: {count} |
| 英語 | Total Visitors: {count} |

---

## 作成/変更ファイル一覧

| ファイル | 操作 | 内容 |
|----------|------|------|
| `package.json` | 更新 | `@vercel/kv` 追加 |
| `app/api/visitors/route.ts` | 新規 | API エンドポイント |
| `components/home/visitor-count.tsx` | 新規 | カウント表示コンポーネント |
| `components/home/index.ts` | 更新 | エクスポート追加 |
| `app/[lang]/page.tsx` | 更新 | コンポーネント統合 |
| `locales/ja.json` | 更新 | 翻訳追加 |
| `locales/en.json` | 更新 | 翻訳追加 |

---

## ステータス
- [x] 要件確認完了
- [x] 計画承認
- [x] 実装完了（ビルド確認済み、デプロイ待ち）
