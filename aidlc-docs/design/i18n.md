# Step 3: å¤šè¨€èªå¯¾å¿œè¨­è¨ˆ

## æ¦‚è¦
next-intl ã‚’ä½¿ç”¨ã—ãŸå¤šè¨€èªå¯¾å¿œï¼ˆi18nï¼‰è¨­è¨ˆ

---

## è¨­è¨ˆæ–¹é‡

### ç¿»è¨³å¯¾è±¡ã®åˆ†é¡

| ç¨®é¡ | ç®¡ç†æ–¹æ³• | ä¾‹ |
|------|---------|-----|
| **UIæ–‡è¨€** | `locales/*.json` (next-intl) | ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„** | `content/**/*.mdx` (è¨€èªåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«) | è¨˜äº‹æœ¬æ–‡ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜ |

### æ¡ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ç”¨é€” |
|-----------|------|
| **next-intl** | UIæ–‡è¨€ã®ç¿»è¨³ã€è¨€èªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç† |

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
my-blog/
â”œâ”€â”€ locales/
â”‚   â”œâ”€â”€ ja.json              # æ—¥æœ¬èªUIæ–‡è¨€
â”‚   â””â”€â”€ en.json              # è‹±èªUIæ–‡è¨€
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ i18n.ts              # i18nè¨­å®šãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ app/
â”‚   â””â”€â”€ [lang]/
â”‚       â””â”€â”€ layout.tsx       # NextIntlClientProvider é…ç½®
â””â”€â”€ middleware.ts            # è¨€èªæ¤œå‡ºï¼ˆStep 2ã§è¨­è¨ˆæ¸ˆã¿ï¼‰
```

---

## next-intl è¨­å®š

### 1. i18n è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

```typescript
// lib/i18n.ts

export const locales = ['ja', 'en'] as const
export type Locale = (typeof locales)[number]

export const defaultLocale: Locale = 'en'

// è¨€èªåï¼ˆUIè¡¨ç¤ºç”¨ï¼‰
export const localeNames: Record<Locale, string> = {
  ja: 'æ—¥æœ¬èª',
  en: 'English',
}

// è¨€èªãŒæœ‰åŠ¹ã‹æ¤œè¨¼
export function isValidLocale(locale: string): locale is Locale {
  return locales.includes(locale as Locale)
}
```

### 2. ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿

```typescript
// lib/i18n.tsï¼ˆç¶šãï¼‰

export async function getMessages(locale: Locale) {
  return (await import(`@/locales/${locale}.json`)).default
}
```

### 3. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§ã® Provider è¨­å®š

```typescript
// app/[lang]/layout.tsx

import { NextIntlClientProvider } from 'next-intl'
import { getMessages, isValidLocale, defaultLocale } from '@/lib/i18n'
import { notFound } from 'next/navigation'

type Props = {
  children: React.ReactNode
  params: { lang: string }
}

export default async function LangLayout({ children, params }: Props) {
  const { lang } = params

  // è¨€èªæ¤œè¨¼
  if (!isValidLocale(lang)) {
    notFound()
  }

  // ç¿»è¨³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—
  const messages = await getMessages(lang)

  return (
    <NextIntlClientProvider locale={lang} messages={messages}>
      {children}
    </NextIntlClientProvider>
  )
}
```

---

## ç¿»è¨³ãƒªã‚½ãƒ¼ã‚¹æ§‹é€ 

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
locales/
â”œâ”€â”€ ja.json
â””â”€â”€ en.json
```

### JSON ã‚¹ã‚­ãƒ¼ãƒ

```json
// locales/ja.json
{
  "common": {
    "siteName": "My Portfolio",
    "loading": "èª­ã¿è¾¼ã¿ä¸­...",
    "error": "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"
  },
  "navigation": {
    "home": "ãƒ›ãƒ¼ãƒ ",
    "projects": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
    "blog": "ãƒ–ãƒ­ã‚°",
    "about": "è‡ªå·±ç´¹ä»‹",
    "contact": "ãŠå•ã„åˆã‚ã›"
  },
  "home": {
    "hero": {
      "title": "ã“ã‚“ã«ã¡ã¯ã€{name}ã§ã™",
      "subtitle": "ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢",
      "cta": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¦‹ã‚‹"
    },
    "featuredProjects": {
      "title": "Featured Projects",
      "viewAll": "ã™ã¹ã¦è¦‹ã‚‹"
    }
  },
  "projects": {
    "title": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
    "technologies": "æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯",
    "viewProject": "è©³ç´°ã‚’è¦‹ã‚‹",
    "noProjects": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Šã¾ã›ã‚“"
  },
  "blog": {
    "title": "ãƒ–ãƒ­ã‚°",
    "readMore": "ç¶šãã‚’èª­ã‚€",
    "publishedAt": "{date}ã«å…¬é–‹",
    "tags": "ã‚¿ã‚°",
    "noPosts": "è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“"
  },
  "about": {
    "title": "è‡ªå·±ç´¹ä»‹"
  },
  "contact": {
    "title": "ãŠå•ã„åˆã‚ã›",
    "form": {
      "name": "ãŠåå‰",
      "email": "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",
      "message": "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
      "submit": "é€ä¿¡"
    }
  },
  "footer": {
    "copyright": "Â© {year} All rights reserved."
  },
  "languageSwitcher": {
    "label": "è¨€èªã‚’åˆ‡ã‚Šæ›¿ãˆ"
  }
}
```

```json
// locales/en.json
{
  "common": {
    "siteName": "My Portfolio",
    "loading": "Loading...",
    "error": "An error occurred"
  },
  "navigation": {
    "home": "Home",
    "projects": "Projects",
    "blog": "Blog",
    "about": "About",
    "contact": "Contact"
  },
  "home": {
    "hero": {
      "title": "Hi, I'm {name}",
      "subtitle": "Software Engineer",
      "cta": "View Projects"
    },
    "featuredProjects": {
      "title": "Featured Projects",
      "viewAll": "View All"
    }
  },
  "projects": {
    "title": "Projects",
    "technologies": "Technologies",
    "viewProject": "View Details",
    "noProjects": "No projects found"
  },
  "blog": {
    "title": "Blog",
    "readMore": "Read more",
    "publishedAt": "Published on {date}",
    "tags": "Tags",
    "noPosts": "No posts found"
  },
  "about": {
    "title": "About Me"
  },
  "contact": {
    "title": "Contact",
    "form": {
      "name": "Name",
      "email": "Email",
      "message": "Message",
      "submit": "Submit"
    }
  },
  "footer": {
    "copyright": "Â© {year} All rights reserved."
  },
  "languageSwitcher": {
    "label": "Switch language"
  }
}
```

### å‘½åè¦å‰‡

| ãƒ«ãƒ¼ãƒ« | ä¾‹ |
|--------|-----|
| ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†é¡ | `navigation.home`, `blog.title` |
| å‹•çš„å€¤ã¯ `{placeholder}` | `"Hello, {name}"` |
| ã‚­ãƒ¼ã¯ camelCase | `viewProject`, `readMore` |

---

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ä½¿ç”¨

### ä½¿ã„åˆ†ã‘ãƒ«ãƒ¼ãƒ«

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¨®åˆ¥ | ä½¿ç”¨API | å‚™è€ƒ |
|------------------|---------|------|
| **Server Components** | `getTranslations()` | async/await ã§å–å¾— |
| **Client Components** | `useTranslations()` | React Hook |

**é‡è¦**: Server Component ã§ `useTranslations` ã‚’ä½¿ã‚ãªã„ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ»è¨­å®šä¾å­˜ã§äº‹æ•…ã‚Šã‚„ã™ã„ã€‚

### Server Components

```typescript
// app/[lang]/page.tsx
// â€» Server Component ã§ã¯ getTranslations ã‚’ä½¿ç”¨

import { getTranslations } from 'next-intl/server'

export default async function HomePage() {
  const t = await getTranslations('home')

  return (
    <section>
      <h1>{t('hero.title', { name: 'John' })}</h1>
      <p>{t('hero.subtitle')}</p>
    </section>
  )
}
```

### Client Components

```typescript
// components/layout/navigation.tsx
// â€» Client Component ã§ã¯ useTranslations ã‚’ä½¿ç”¨

'use client'

import { useTranslations } from 'next-intl'
import Link from 'next/link'

export function Navigation({ lang }: { lang: string }) {
  const t = useTranslations('navigation')

  const links = [
    { href: `/${lang}`, label: t('home') },
    { href: `/${lang}/projects`, label: t('projects') },
    { href: `/${lang}/blog`, label: t('blog') },
    { href: `/${lang}/about`, label: t('about') },
    { href: `/${lang}/contact`, label: t('contact') },
  ]

  return (
    <nav>
      {links.map(link => (
        <Link key={link.href} href={link.href}>
          {link.label}
        </Link>
      ))}
    </nav>
  )
}
```

### å‹•çš„å€¤ã®ä½¿ç”¨ï¼ˆClient Componentï¼‰

```typescript
// components/blog/post-meta.tsx
// â€» Client Component ã§ã®æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¾‹

'use client'

import { useTranslations, useFormatter } from 'next-intl'

export function PostMeta({ date }: { date: Date }) {
  const t = useTranslations('blog')
  const format = useFormatter()

  const formattedDate = format.dateTime(date, {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  })

  return <time>{t('publishedAt', { date: formattedDate })}</time>
}
```

### å‹•çš„å€¤ã®ä½¿ç”¨ï¼ˆServer Componentï¼‰

```typescript
// app/[lang]/blog/[slug]/page.tsx
// â€» Server Component ã§ã®æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¾‹

import { getTranslations, getFormatter } from 'next-intl/server'

export default async function PostPage() {
  const t = await getTranslations('blog')
  const format = await getFormatter()

  const formattedDate = format.dateTime(new Date(), {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  })

  return <time>{t('publishedAt', { date: formattedDate })}</time>
}
```

---

## è¨€èªåˆ‡æ›¿ UI

### å®Ÿè£…ï¼ˆStep 2 ã‹ã‚‰æ›´æ–°ï¼‰

```typescript
// components/layout/language-switcher.tsx

'use client'

import { usePathname, useRouter } from 'next/navigation'
import { useTranslations } from 'next-intl'
import { locales, localeNames, type Locale } from '@/lib/i18n'

type Props = {
  currentLang: Locale
}

export function LanguageSwitcher({ currentLang }: Props) {
  const pathname = usePathname()
  const router = useRouter()
  const t = useTranslations('languageSwitcher')

  const switchLanguage = (newLang: Locale) => {
    // Cookie æ›´æ–°
    document.cookie = `lang=${newLang}; path=/; max-age=${60 * 60 * 24 * 365}`

    // ãƒ‘ã‚¹å¤‰æ›ï¼ˆå…ˆé ­ã®ã¿ç½®æ›ï¼‰
    const newPath = pathname.replace(
      new RegExp(`^/${currentLang}(?=/|$)`),
      `/${newLang}`
    )
    router.push(newPath)
  }

  return (
    <div role="group" aria-label={t('label')}>
      {locales.map(locale => (
        <button
          key={locale}
          onClick={() => switchLanguage(locale)}
          disabled={locale === currentLang}
          aria-current={locale === currentLang ? 'true' : undefined}
        >
          {localeNames[locale]}
        </button>
      ))}
    </div>
  )
}
```

### ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è€ƒæ…®

| å±æ€§ | ç”¨é€” |
|------|------|
| `role="group"` | ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã—ã¦èªè­˜ |
| `aria-label` | ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å‘ã‘ãƒ©ãƒ™ãƒ« |
| `aria-current` | ç¾åœ¨é¸æŠä¸­ã®è¨€èªã‚’æ˜ç¤º |
| `disabled` | ç¾åœ¨ã®è¨€èªã¯ç„¡åŠ¹åŒ– |

---

## Cookie ç®¡ç†

### Cookie ä»•æ§˜

| é …ç›® | å€¤ |
|------|-----|
| åå‰ | `lang` |
| å€¤ | `ja` or `en` |
| æœ‰åŠ¹æœŸé™ | 1å¹´ |
| ãƒ‘ã‚¹ | `/` |
| SameSite | `Lax`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ |

### èª­ã¿å–ã‚Šç®‡æ‰€

| ç®‡æ‰€ | æ–¹æ³• |
|------|------|
| middleware | `request.cookies.get('lang')` |
| Client Component | `document.cookie` |

### æ›¸ãè¾¼ã¿ç®‡æ‰€

| ç®‡æ‰€ | ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|------|-----------|
| middleware | åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ™‚ï¼‰ |
| LanguageSwitcher | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨€èªåˆ‡æ›¿æ™‚ |

---

## ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å¤šè¨€èªå¯¾å¿œ

### MDX ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
content/
â”œâ”€â”€ projects/
â”‚   â”œâ”€â”€ ja/
â”‚   â”‚   â””â”€â”€ my-portfolio.mdx
â”‚   â””â”€â”€ en/
â”‚       â””â”€â”€ my-portfolio.mdx
â””â”€â”€ posts/
    â”œâ”€â”€ ja/
    â”‚   â””â”€â”€ nextjs-setup.mdx
    â””â”€â”€ en/
        â””â”€â”€ nextjs-setup.mdx
```

### è¨€èªåˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å–å¾—

```typescript
// lib/posts.ts

import { Locale } from './i18n'

export async function getPostBySlug(locale: Locale, slug: string) {
  const filePath = `content/posts/${locale}/${slug}.mdx`
  // ... MDXå‡¦ç†
}

export async function getAllPosts(locale: Locale) {
  const postsDir = `content/posts/${locale}`
  // ... ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—
}
```

### æ—¥æœ¬èªãƒ»è‹±èªã®éå¯¾ç§°å¯¾å¿œ

è¦ä»¶ï¼šã€Œæ—¥æœ¬èªãƒ»è‹±èªã®è¨˜äº‹ã¯å®Œå…¨ä¸€è‡´ã§ãªãã¦OKã€

| ã‚±ãƒ¼ã‚¹ | å¯¾å¿œ |
|--------|------|
| ä¸¡è¨€èªã«å­˜åœ¨ | ä¸¡æ–¹è¡¨ç¤º |
| æ—¥æœ¬èªã®ã¿ | æ—¥æœ¬èªãƒšãƒ¼ã‚¸ã§è¡¨ç¤ºã€è‹±èªãƒšãƒ¼ã‚¸ã§ã¯éè¡¨ç¤º |
| è‹±èªã®ã¿ | è‹±èªãƒšãƒ¼ã‚¸ã§è¡¨ç¤ºã€æ—¥æœ¬èªãƒšãƒ¼ã‚¸ã§ã¯éè¡¨ç¤º |

---

## ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®å¤šè¨€èªå¯¾å¿œ

### generateMetadata ã§ã®å¯¾å¿œ

```typescript
// app/[lang]/page.tsx

import { getTranslations } from 'next-intl/server'
import type { Metadata } from 'next'

type Props = {
  params: { lang: string }
}

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const t = await getTranslations({ locale: params.lang, namespace: 'home' })

  return {
    title: t('hero.title', { name: 'John' }),
    description: t('hero.subtitle'),
  }
}
```

---

## ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

| ãƒã‚¤ãƒ³ãƒˆ | çµæœ | å¯¾å¿œ |
|---------|------|------|
| Server Component ã§ã® useTranslations | ğŸŸ¡ ä¿®æ­£æ¸ˆã¿ | `getTranslations` ã«å¤‰æ›´ã€ä½¿ã„åˆ†ã‘ãƒ«ãƒ¼ãƒ«è¿½åŠ  |

---

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… æ‰¿èªæ¸ˆã¿
